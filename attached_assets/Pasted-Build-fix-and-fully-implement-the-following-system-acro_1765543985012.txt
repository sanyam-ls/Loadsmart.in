Build, fix, and fully implement the following system across Admin Console, Shipper Portal, and Carrier Portal.
All buttons MUST work and trigger real state updates.
If backend is not implemented, simulate success responses and state transitions.

â¸»

================================

ğŸ”¥ 1. CRITICAL FIXES REQUIRED

================================

A. Fix â€œSend Invoiceâ€ button

Required behavior:
	â€¢	On click â†’ validate fields â†’ call /api/admin/invoice/send.
	â€¢	If endpoint exists â†’ return success, update invoice status to SentToShipper, show success toast, close modal, and update all affected dashboards.
	â€¢	If endpoint does not exist â†’ SIMULATE success:
	â€¢	Update invoice object in local store
	â€¢	status = "SentToShipper"
	â€¢	Emit event to Shipper Portal
	â€¢	Show success toast "Invoice Sent"

Additional requirements:
	â€¢	Must show a loading spinner on click.
	â€¢	Button must be disabled during API call.
	â€¢	Must show REAL error messages from server.
	â€¢	Must support an Idempotency-Key header so multiple clicks do NOT duplicate invoices.
	â€¢	If backend fails, display:
â€œInvoice failed: <server_message>â€

â¸»

B. Fix â€œLock & Post Loadâ€ button

Required behavior:
	â€¢	On click â†’ validate pricing â†’ call /api/admin/load/lock-and-post.
	â€¢	If endpoint missing â†’ SIMULATE success:
	â€¢	Set load.status = "Posted"
	â€¢	Set pricing.locked = true
	â€¢	Show "Load posted successfully"
	â€¢	Update Carrier Portal with new load entry.

Additional requirements:
	â€¢	Must disable button + show spinner while in progress.
	â€¢	Must show actionable error:
â€œFailed to lock and post load: â€
	â€¢	Must update Admin dashboard metrics instantly:
	â€¢	Active Loads +1
	â€¢	Pending Loads âˆ’1

â¸»

================================

ğŸ”¥ 2. FULL INVOICE BUILDER WORKFLOW

================================

Implement the entire invoice builder flow, making sure each step WORKS:

1. Admin opens â€œInvoice Builderâ€ modal.

Populate fields:
	â€¢	Load info
	â€¢	Shipper ID
	â€¢	Editable line items
	â€¢	Qty / rate auto-calculation
	â€¢	Payment terms
	â€¢	Due date
	â€¢	Notes

2. Admin may:
	â€¢	Add item
	â€¢	Remove item
	â€¢	Edit amount
	â€¢	Save Draft
	â€¢	Send Invoice

3. On Send Invoice:
	â€¢	Validate required fields
	â€¢	Generate unique invoice number
	â€¢	Calculate totals (sub, tax, grand total)
	â€¢	Generate PDF (simulate if backend unavailable)
	â€¢	Push invoice into Shipper Portal documents
	â€¢	Update Admin â†’ Invoices list
	â€¢	Update Load â†’ invoiceId

4. Shipper Portal must show:
	â€¢	Invoice in â€œDocumentsâ€ section
	â€¢	Invoice inside â€œLoad Detailsâ€
	â€¢	Buttons: Download PDF, Acknowledge, Pay (mock)

5. Payment mock:
	â€¢	On â€œPay Nowâ€:
	â€¢	invoice.status = "Paid"
	â€¢	write payment record
	â€¢	update dashboards

6. Every invoice action MUST write an internal history entry:
	â€¢	created
	â€¢	edited
	â€¢	sent
	â€¢	viewed
	â€¢	paid

â¸»

================================

ğŸ”¥ 3. ADMIN PRICING ENGINE (WORKING)

================================

Keep all the AI estimation features you already built.

Add new required behavior:

When admin finalizes price:
	â€¢	Must calculate:
	â€¢	base
	â€¢	fuel
	â€¢	handling
	â€¢	seasonal multiplier
	â€¢	admin markup
	â€¢	discount
	â€¢	final price
	â€¢	carrier payout
	â€¢	platform margin

Must enforce:
	â€¢	no negative totals
	â€¢	markup cannot be applied twice
	â€¢	UI always reflects calculations instantly

â¸»

================================

ğŸ”¥ 4. CARRIER BID + SHIPPER FLOW (WORKING)

================================

Implement or simulate:

Carrier sees:
	â€¢	Posted loads
	â€¢	Admin-set payout
	â€¢	Button: Accept / Counter

Shipper sees:
	â€¢	Load status updates automatically
	â€¢	Invoice after admin sends

â¸»

================================

ğŸ”¥ 5. BACKEND ENDPOINTS (IMPLEMENT OR SIMULATE)

================================

Implement these endpoints.
If backend unavailable, simulate with mock responses and persist state in front-end store.

/api/admin/invoice/create

/api/admin/invoice/send

/api/admin/load/lock-and-post

/api/admin/invoice/pdf (optional async)

/api/shipper/invoice/acknowledge

/api/shipper/invoice/pay
================================

ğŸ”¥ 6. SIMULATION RULES

================================

If any backend endpoint is missing:
	â€¢	Simulate it.
	â€¢	Update local store.
	â€¢	Update UI state.
	â€¢	Trigger toast notifications.
	â€¢	Trigger dashboard metric updates.
	â€¢	Log action to internal event history.

This ensures every button works even during backend development.

â¸»

================================

ğŸ”¥ 7. ACCEPTANCE TESTS (MUST PASS)

================================

âœ… Test 1 â€” Send Invoice
	â€¢	Click â†’ Loader shows â†’ Success toast â†’ Invoice appears in Shipper Portal.

âœ… Test 2 â€” Lock & Post Load
	â€¢	Click â†’ Loader shows â†’ Load moves from Pending â†’ Posted â†’ Visible in Carrier Portal.

âœ… Test 3 â€” Error handling
	â€¢	If validation fails â†’ specific field highlighted + specific error displayed.

âœ… Test 4 â€” Carrier sees posted load
	â€¢	After admin posts, load must appear instantly in Carrier Portal Available Loads.

âœ… Test 5 â€” Shipper can download invoice PDF
	â€¢	Regardless of backend, PDF link must open (mock acceptable).

â¸»

================================

ğŸ”¥ 8. NON-NEGOTIABLE REQUIREMENTS

================================
	â€¢	Buttons must always give feedback (loading + disabled).
	â€¢	Every API must return real server errors to UI (no generic toasts).
	â€¢	If backend not ready â†’ simulate success.
	â€¢	All totals must calculate live.
	â€¢	Data must sync across portals instantly.
	â€¢	No empty states â€” show placeholder data with examples.
	â€¢	Dark mode must apply to new modals.

â¸»

================================

ğŸ”¥ 9. FINAL INSTRUCTION TO REPLIT

================================

Implement EVERYTHING above.
Fix all failing buttons.
Make all workflows clickable, functional, stateful, and synced.
Simulate where backend is missing.
Ensure the system behaves like a fully working MVP end-to-end.
