Context: Admin is troubleshooting and managing the Price & Post flow for loads. Primary goals: diagnose why Lock & Post fails, permit safe manual overrides, generate/send invoices, and record audit evidence. Use these instructions as authoritative runbook actions, checks, and controls.

⸻

1) Admin Actions (UI controls & commands)
	•	View Load — shows full load summary + pricing modal state (AI price, markup, final price, metadata).
	•	Impersonate User — open Price & Post modal as the original user (read-only unless admin toggle enabled).
	•	Force Post — server-side POST to /api/loads/{id}/post bypassing client validation (requires admin reason).
	•	Generate Invoice (Standalone) — force-generate invoice PDF for final_price and attach to load record.
	•	Send/Resend Invoice — send invoice email to shipper; choose channel: email/SMS/API webhook.
	•	Save Draft (server) — save current modal payload to DB as draft; returns draft ID.
	•	Requeue Post — place load in posting queue for background worker retry.
	•	View Last API Response — show last 50 logs for /loads/{id}/post and invoice generation endpoints.
	•	Export HAR / Network Trace — export client HAR if needed.
	•	View Console Errors — aggregated JS errors from RUM for that user/session.
	•	Toggle Feature Flag — price_post_force_enabled, invoice_autosend, post_queue_mode (on/off).
	•	Permissions Audit — show user roles & whether they have post permission; escalate grant option.
	•	Show Audit Trail — timeline: UI attempts, server responses, admin actions, invoice sends.
	•	Create Support Ticket (auto-fill) — composes ticket with attached logs, HAR, and reason.
	•	Rollback Final Price — revert to previous locked price version (with audit note).

⸻

2) Diagnostics Steps (admin checklist — run in order)
	1.	Load Basics
	•	Load ID, user, timestamp, origin→dest, distance, weight, equipment, region.
	•	Final Price value visible? (Yes/No). If No → stop: surface “Final price missing”.
	2.	Permission Check
	•	Does the user have post_load permission? If no, show quick grant option and retest.
	3.	Client vs Server
	•	Check last client attempt: did the browser send a POST request?
	•	If no request, check RUM: JS error or disabled button state. View Console Errors.
	•	If request sent, capture API response.
	4.	API Response
	•	Status 2xx → success (but UI may have failed to display). Reconcile state; mark posted.
	•	4xx → validation/permission issue. Parse response JSON -> surface errors.
	•	5xx/timeout → server error. Requeue and notify engineering pager.
	5.	Invoice Generation
	•	If post succeeded but invoice not sent: check invoice_autosend flag, invoice generation logs, PDF generation errors.
	6.	System Health
	•	Check worker queue length for post_job and invoice_job. If > threshold, notify SRE.
	7.	Edge Cases
	•	Final Price is NaN/overflow: detect if numeric parsing failed (currency formatting mismatch). Offer manual numeric correction.
	•	Large numbers trigger DB field overflow: show schema field size and suggest patch.

⸻

3) Safe Remediation Flow (what admin should do)
	•	If client-side block (no request):
	1.	Copy final price and Generate Invoice (Standalone) and Send Invoice to shipper immediately.
	2.	Save Draft server-side.
	3.	Create support ticket with HAR + console errors; set priority = High.
	•	If API returns 4xx with validation errors:
	1.	Show exact validation message inline; optionally Force Post after admin confirms manual override and records reason.
	2.	If missing shipper info, open quick-edit to add required fields and retry post.
	•	If API 5xx or timeout:
	1.	Requeue Post for background retry.
	2.	Generate Invoice (Standalone) if business requires immediate invoice; attach note: invoice provisional pending platform confirmation.
	3.	Notify Engineering & SRE with logs and queue state.
	•	If permission failure:
	1.	Use Permissions Audit to grant temporary post_load role with expiry, then retest.
	2.	Log admin action in audit trail.
	•	If invoice generation fails:
	1.	Generate PDF via fallback template, attach to load, and Send Invoice manually.
	2.	Mark invoice status as sent_provisional with audit note.

⸻

4) Admin Safety Controls & Governance
	•	Force Post requires: admin id, reason, and optional TTL flag temp_post=true (auto-revoke).
	•	All admin overrides create immutable audit entries: admin id, IP, timestamp, reason, before/after payload.
	•	Invoice send must include sent_by (admin/system) and channel; if system=false, label as manual_send.
	•	Feature flag changes must require 2FA confirmation if they affect production invoice behaviors.

⸻

5) Monitoring & Alerts (what to trigger)
	•	Alert if post_job_queue_length > 5 for > 5 minutes.
	•	Alert if post_api_failure_rate > 2% in last 5 minutes.
	•	Alert if invoice_generation_errors > 1% or any PDF generation exception.
	•	RUM: surface JS errors tied to price-post-modal component, aggregated by error signature.

⸻

6) Admin Acceptance Criteria (when issue considered resolved)
	•	Lock & Post action returns 200 and load state = posted in DB.
	•	Carrier bidding event created and visible on Carrier Board with event ID.
	•	Invoice PDF generated, attached to load, and email webhook shows 2xx delivery.
	•	Audit trail contains admin/automatic actions with timestamps and logs.
	•	Post failures have one of: queued retry scheduled, admin forced post documented, or shipper invoiced manually.

⸻

7) Test Cases (one-click test actions)
	•	Test A: User with correct permissions posts; expect success path.
	•	Test B: User missing shipper field; expect validation error and tooltip; admin should correct and post.
	•	Test C: Simulate network failure; ensure draft saved + requeue + provisional invoice can be generated.
	•	Test D: Force Post via admin and verify carriers receive notification and invoice generated.

⸻

8) Quick Admin Response Templates (copy/paste)
	•	Create Support Ticket
	•	Title: Lock & Post failing — Load {id} — {user} — {timestamp}
	•	Body: Attach audit logs, HAR, console trace, API response, queue metrics, reproduction steps, urgency: High.
	•	Notify Shipper (manual invoice)
	•	Subject: Provisional Invoice — Load {id} — Rs. {final_price}
	•	Body: “We attempted to post your load on our platform but experienced a system error. Attached is a provisional invoice for Rs. {final_price}. We will confirm on-platform posting within 2 hours. — Ops Team”

⸻

9) Developer Handoff (auto-filled fields)

When creating dev ticket, include:
	•	Last API response body for /loads/{id}/post
	•	HAR file
	•	RUM session id
	•	Queue snapshot
	•	DB row dump for load (masked PII)
	•	Steps to reproduce (impersonation link + timestamp)