MASTER PROMPT — Replit AI
Goal: Implement “Admin-as-Mediator” flow across Shipper → Admin → Carrier while preserving Loadlink’s advanced features (matching, bidding, documents, tracking, analytics). Deliver a fully functional mock/product prototype with synced mock data, clickable dashboards, audit trails, and integration points for telematics / CAN-Bus later.

⸻

1) High-level requirement
	•	Shippers submit raw loads (no rate). All pricing, posting, invitations and assignments are done by Admin. Carriers see only Admin-posted loads (with admin price and posting mode). Carriers can accept admin price or counter only when Admin policy allows. Admin controls posting mode: Open / Invite / Assign.
	•	Preserve advanced capabilities from existing platform: matching service, smart recommendations, advanced bidding engine, document flows, tracking, revenue analytics, notification templates, role-based access, and exportable reports.

⸻

2) UX changes (explicit)

Shipper UI
	•	Replace “expected rate” field with clear text: “We will evaluate & price your load — you’ll be notified when it’s posted/assigned.”
	•	After submission, show status: Submitted → Pending Admin Review. Provide a small timeline widget showing Admin action history.
	•	Allow attachments and KYC upload. Shipper can add optional “preferred carriers” checkbox, but it won’t affect pricing.

Admin Console
	•	Add Admin Queue (default landing for new loads) with filters: region, load type, priority, KYC status.
	•	Add Estimation Tool: auto-suggest price using a rules engine (distance × base rate × load-type multiplier + dynamic fuel surcharge ± margin). UI shows suggested price, editable final price, posting mode selector (Open/Invite/Assign), and quick invite list (select carriers).
	•	Add Audit Log / AdminDecision panel (immutable record with admin_id, timestamp, suggested_price, final_price, posting_mode, comment).
	•	Add bulk actions: multi-invite, bulk assign, bulk archive.
	•	Add policy toggles: allow counter-bids (on/off), maximum markup %, auto-approve thresholds.

Carrier UI
	•	Loads show badge: Posted by Admin and label Price Fixed or Negotiable (based on admin policy).
	•	Actions: Accept at admin price (one-click), Counter (only if allowed), Request details (sends note to Admin).
	•	If accepted: immediate order creation flow visible; trip lifecycle starts.

⸻

3) Data model updates (explicit fields)
	•	Load table: add submitted_by, submitted_at, status (SubmittedToAdmin, Open, PostedToCarrier, Assigned, Archived), admin_suggested_price, admin_final_price, admin_post_mode, admin_id, admin_decision_id.
	•	AdminDecision table: id, admin_id, load_id, suggested_price, final_price, posting_mode, comment, created_at.
	•	Bid table: keep existing but add bid_type ENUM {CarrierBid, AdminPostedAcceptance, AdminCounter} and approval_required boolean.
	•	Order table: add origin_load_id, admin_price, carrier_price, final_price, settlement_status.
	•	Events: implement event names LoadSubmittedToAdmin, AdminPricedLoad, AdminPostedLoad, CarrierAcceptedAdminPrice, CarrierCounterBid, AdminAssignedLoad.

⸻

4) Service & API changes (endpoints to implement)

Implement these REST endpoints (request/response shapes described in spec form — add auth tokens):
	•	POST /api/loads/submit — Shipper submits raw load (no price). Returns load_id and status SubmittedToAdmin.
	•	GET /api/admin/queue — Admin list of SubmittedToAdmin loads (filters).
	•	POST /api/admin/price — Admin prices a load: payload { load_id, suggested_price, final_price, post_mode, invite_carrier_ids[] }. Writes AdminDecision and updates Load status.
	•	POST /api/loads/post — Publish load to carrier boards (Open/Invite/Assign). Triggers notifications.
	•	GET /api/carrier/loads — Carriers fetch admin-posted loads (supports posted_by_admin filter).
	•	POST /api/bids/submit — Carrier submits bid (or accept admin price). If accept admin price, create CarrierBid with bid_type=AdminPostedAcceptance.
	•	POST /api/admin/assign — Admin force-assign carrier to load (create order).
	•	GET /api/admin/audit/:load_id — fetch AdminDecision history.
	•	GET /api/reports/revenue?load_id|month|region — fetch revenue breakdown (for Admin).

(Also include telemetry endpoints for future CAN-Bus: POST /api/telemetry/truck/:id.)

⸻

5) Business logic (rules engine & policies)
	•	Default: carriers can only accept Admin price; counter-bids disabled. Admin toggles allow counter.
	•	Auto-suggest price algorithm: distance * baseRate(loadType) + fuelSurcharge(distance, fuelIndex) + handlingFee + adminMargin. Provide sample coefficients and make configurable in admin UI.
	•	Auto-assign thresholds: if suggested price margin <= X% of benchmark and autoAssignEnabled, system can auto-assign to top-matched carrier and notify Admin.
	•	KYC gate: No admin posting to carriers unless shipper meets minimalKYC (configurable).
	•	Audit rules: Any admin override > Y% from suggested price requires secondary admin approval.

⸻

6) Notifications & templates
	•	Admin notifications: new load submitted, carrier counter-bid, acceptance, non-responses.
	•	Shipper notifications: load received, load posted, carrier assigned, trip started, POD uploaded, invoice generated.
	•	Carrier notifications: invited to load, new admin-posted load, bid accepted/rejected, assigned to order.
	•	Channels: Push, Email, SMS, WhatsApp (integrated templates for India). Provide mock keys and show sample payload.

⸻

7) Sync & dashboards
	•	Ensure all dashboards (Admin, Shipper, Carrier) pull from same central mock datastore so actions reflect instantly across UIs.
	•	Dashboard tiles to populate:
	•	Admin: Pending Admin Loads, Loads Posted, Loads Assigned, Revenue, KYC Pending.
	•	Carrier: Active Trucks, Pending Bids, Active Trips, Monthly Revenue (all populated with realistic mock data).
	•	Shipper: Loads Submitted (status), Recent Assignments, Invoices.
	•	Clickable tiles open actual detail pages with logs, audit trail, documents, and ability to perform actions.

⸻

8) Documents / Orders / Tracking / Payments (no change in logic — only admin visibility)
	•	Orders are created after Admin posts and Carrier accepts (or Admin assigns).
	•	Document flows (LR, POD, Invoice) remain; Admin sees all documents and can intervene.
	•	Tracking uses app GPS or telematics; integrate mock telemetry and provide a Start Trip / Stop Trip flow.
	•	Payment: Admin-generated invoice (based on admin_final_price) — Shipper pays; settlement flows unaffected but Admin can hold/release in dispute.

⸻

9) Mock data & testing
	•	Populate system with realistic mock data: 500 loads (mix of SubmittedToAdmin and Open), 300 carriers (varied KYC), 1000 trucks, 155 pending bids, 40 active trips, monthly revenue timeseries for 12 months.
	•	Provide unit test list: submit load, admin price and post, carrier accept, order creation, tracking start, POD upload, invoice generation, payout record.
	•	Provide end-to-end test scripts (Postman collection or cURL) for each major flow.

⸻

10) Acceptance criteria (deliverables)
	•	All endpoints above implemented with auth & role checks.
	•	Admin Queue visible with ability to price and post (Open/Invite/Assign).
	•	AdminDecision audit entries are immutable and visible in load detail view.
	•	Carriers only see admin-posted loads; accepts create orders that reflect admin_final_price.
	•	Dashboards show synced mock data and clickable tiles going to correct pages.
	•	Notifications triggered on each major event (mock channels OK).
	•	Mock dataset loaded and accessible via GET /api/mock/data-summary.
	•	Export: revenue/report data as CSV for given month/region/load.
	•	Telemetry stub endpoint POST /api/telemetry/truck/:id accepts simulated GPS payloads and updates trip progress.

⸻

11) Non-functional requirements
	•	Role-based access for Shipper/Carrier/Admin.
	•	Audit trail for every admin action.
	•	Configurable rules and admin policy toggles.
	•	Scalable service separation (suggest microservice boundaries: Auth, LoadMgmt, Bidding, AdminDecision, Order, Tracking, Payment, Notification).
	•	Provide inline documentation (OpenAPI / Swagger) and README with run instructions.

⸻

12) Handoff & deliverables

Deliver:
	1.	Replit project with working UI prototypes (Admin, Shipper, Carrier) and implemented endpoints.
	2.	Mock dataset loaded and accessible.
	3.	Postman collection or script to run end-to-end flows.
	4.	README with how to switch counter-bids on/off, how to change auto-suggest coefficients, and how to load mock data.
	5.	Short demo script for QA verifying acceptance criteria.

⸻

13) Future hooks (CAN-Bus / Telematics)
	•	Leave telemetry service/endpoint ready for plugin of CAN-Bus or telematics provider. UI should consume telemetry to update trip progress and fuel metrics when real devices are connected.

⸻

Tone & expectations for Replit AI
	•	Keep Loadlink’s existing advanced features intact (matching, docs, UI metaphors).
	•	Make minimal UI changes to Shipper (remove price field) and major Admin changes (queue & estimation).
	•	Keep Carrier UX intuitive: show Posted by Admin label; provide one-click Accept action.
	•	Prioritize auditability, traceability and real-time sync.
	•	Build with modular services; document APIs and event names.